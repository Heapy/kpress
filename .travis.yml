language: java

jobs:
  include:
  - stage: build
    if: branch != master OR type IN (pull_request)
    jdk: openjdk11
    script:
    - ./gradlew check
  - stage: build
    if: branch != master OR type IN (pull_request)
    jdk: oraclejdk10
    script:
    - ./gradlew check
  - stage: build
    if: branch != master OR type IN (pull_request)
    jdk: oraclejdk8
    script:
    - ./gradlew check
  - stage: build
    if: branch = master AND type IN (push)
    jdk: openjdk11
    script:
    - ./gradlew check
  - stage: build
    if: branch = master AND type IN (push)
    jdk: oraclejdk10
    script:
    - ./gradlew check
  - stage: build
    if: branch = master AND type IN (push) AND repo = Heapy/kpress
    jdk: oraclejdk8
    script:
    - echo "TODO - Deploy here."
    - ./gradlew check
  - stage: build
    if: branch = master AND type IN (push) AND repo != Heapy/kpress
    jdk: oraclejdk8
    script:
    - ./gradlew check

before_cache:
- rm -f  "${HOME}/.gradle/caches/modules-2/modules-2.lock"
- rm -f  "${HOME}/.gradle/caches/*/fileHashes/fileHashes.lock"
- rm -rf "${HOME}/.gradle/caches/*/plugin-resolution/"

cache:
  directories:
  - "${HOME}/.gradle/caches/"
  - "${HOME}/.gradle/wrapper/"
